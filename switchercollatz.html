<!DOCTYPE html>
<html>
<head>
<title>Alpha Adaptation Summary</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
pre { background: #f4f4f4; padding: 10px; }
</style>
</head>
<body>
<h1>Alpha Adaptation Research Summary</h1>
<button onclick="run()">Run Simulation</button>
<pre id="output">Click "Run Simulation" to start...</pre>

<script>
function run() {
    const maxN = 10000;
    const maxX = 500;
    const maxIter = 10000;

    let stageStats = [
        { name: "Stage 1", count: 0, iterations: [], color: "green" },
        { name: "Stage 2", count: 0, iterations: [], color: "yellow" },
        { name: "Stage 3", count: 0, iterations: [], color: "orange" },
        { name: "Stage 4", count: 0, iterations: [], color: "blue" }
    ];
    let failCount = 0;
    let totalCases = 0;
    let failList = [];

    function tryStage(n, x, stage) {
        let iter = 0;
        let visited = new Set();
        let beta = n % x;
        let alpha;

        while (iter < maxIter) {
            // Choose alpha based on stage rules
            if (stage === 1) {
                alpha = (beta <= x / 2) ? -beta : x - beta;
            } else if (stage === 2) {
                alpha = (beta <= x / 2) ? x - beta : -beta;
            } else if (stage === 3) {
                alpha = -beta;
            } else if (stage === 4) {
                alpha = x - beta;
            }

            let newN = n + alpha;
            if (newN % x === 0) return iter + 1;

            // Detect cycles
            let key = `${n},${beta}`;
            if (visited.has(key)) return null;
            visited.add(key);

            // Update for next loop
            n = newN;
            beta = n % x;
            iter++;
        }
        return null;
    }

    for (let n = 1; n <= maxN; n++) {
        for (let x = 1; x <= maxX; x++) {
            totalCases++;
            let solved = false;
            for (let stage = 1; stage <= 4; stage++) {
                let res = tryStage(n, x, stage);
                if (res !== null) {
                    stageStats[stage - 1].count++;
                    stageStats[stage - 1].iterations.push(res);
                    solved = true;
                    break;
                }
            }
            if (!solved) {
                failCount++;
                failList.push({ n, x });
            }
        }
    }

    // Prepare output
    let out = "";
    stageStats.forEach(stat => {
        let avgIter = stat.iterations.reduce((a, b) => a + b, 0) / stat.iterations.length || 0;
        let maxIterCount = Math.max(...stat.iterations, 0);
        out += `${stat.name}: ${(stat.count / totalCases * 100).toFixed(2)}% `
             + `(${stat.count} cases), Avg Iter: ${avgIter.toFixed(2)}, `
             + `Max Iter: ${maxIterCount}\n`;
    });
    out += `Fail: ${(failCount / totalCases * 100).toFixed(2)}% (${failCount} cases)\n`;
    out += `Total cases: ${totalCases}\n`;

    document.getElementById("output").textContent = out;
    console.log("Failures:", failList);
}
</script>
</body>
</html>
